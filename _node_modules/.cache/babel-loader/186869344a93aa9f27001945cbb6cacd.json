{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Button,Modal,message}from'antd';import{API,getData,sendDataBody}from'../../resources';import DetalleNota from'./detalleNota';import DetalleHistoria from'./detalleHistoria';import DetallesPaciente from'../pacientes/detalles.paciente';import{PrinterOutlined,CloudDownloadOutlined}from'@ant-design/icons';import ExpedienteDocument from'./expedienteForPrint';// import html2canvas from 'html2canvas'; deprecated\n// import { jsPDF } from \"jspdf\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Expedientes(_ref){let{paciente,setIsEditModalOpen}=_ref;const[expedientesData,setExpedientesData]=useState(null);const[expedientesLoading,setExpedientesLoading]=useState(true);const[historia,setHistoria]=useState(\"\");const[historiaDetails,sethistoriaDetails]=useState(\"\");const[notas,setNotas]=useState(\"\");const[recetas,setRecetas]=useState(\"\");const[citas,setcitas]=useState(\"\");// Print modal\nconst[isModalOpen,setIsModalOpen]=useState(false);const showModal=()=>{setIsModalOpen(true);};const handleOk=()=>{setIsModalOpen(false);};const handleCancel=()=>{setIsModalOpen(false);};// Print modal end\nconst{_id:id_paciente}=paciente;useEffect(()=>{getExpedientesData(id_paciente);getPatientRegisters(id_paciente);},[id_paciente]);const getExpedientesData=id_paciente=>{// console.log('Received patient exp doc ', id_paciente)\nfetch(API+\"expedientes/\".concat(id_paciente)).then(response=>response.json()).then(data=>{// console.log(\"GetExpData: \", data);\nsetExpedientesData(data);if(typeof data!=\"undefined\"&&data!==null){// setNotas(data.notas); \nsetHistoria(data.historia);getHistoriaData(data.historia);}else{setNotas(null);setHistoria(null);}}).finally(()=>setExpedientesLoading(false));};const getPatientRegisters=id_paciente=>{getData(\"notas/\".concat(id_paciente)).then(rs=>setNotas(rs));getData(\"receta/\".concat(id_paciente)).then(rs=>setRecetas(rs));getData(\"citas/\".concat(id_paciente)).then(rs=>setcitas(rs));};const getHistoriaData=historia=>{getData(\"historia/\".concat(historia)).then(rs=>{sethistoriaDetails(rs);});};async function addHistoria(){return sendDataBody('historias/add',{historial:\"Historia clinica al \"+new Date()});}const createPAtientData=async usr=>{const historia=await addHistoria();const postBody={usuario:usr,historia:historia.id_historia,notas:[],recetas:[]};// console.log('postBodyForExpedient: ', postBody);\nsendDataBody('expedientes/add',postBody).then(response=>{// console.log('Success:', response);\nmessage.success(response.message||response.error);if(response.message&&response.message==='Expediente creado correctamente'){getExpedientesData(id_paciente);}});};function DownloadConscent(){// El archvo de conscentmiento se guardará en ./uploads y se llamara con /notas/estudos/download de momento porque no hay un endpoint para archivo de conscentimento para subrlo sera en /notas/estudus/upload\nreturn/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(CloudDownloadOutlined,{className:\"teamSocialIcon\"}),style:{marginLeft:12},href:\"\".concat(API,\"notas/estudios/download/3d4c9465-889f-428c-9e15-13bea15162ef.doc\"),children:\"Avso de Conscentmiento\"});}if(expedientesLoading)return/*#__PURE__*/_jsx(\"p\",{children:\"Cargando...\"});return/*#__PURE__*/_jsxs(\"div\",{id:\"expedient-export\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'row',gap:15},children:[/*#__PURE__*/_jsx(DetallesPaciente,{paciente:paciente,setIsEditModalOpen:setIsEditModalOpen}),/*#__PURE__*/_jsx(DetalleHistoria,{historia:historia,detalles_paciente:paciente})]}),expedientesData?/*#__PURE__*/_jsx(DetalleNota,{id_expediente:expedientesData._id,prevExpNotas:expedientesData.notas,paciente:id_paciente,datosPaciente:paciente}):/*#__PURE__*/_jsxs(\"div\",{style:{},children:[\"Sin expediente\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{onClick:()=>{createPAtientData(id_paciente);},children:\"Crear Expediente Ahora\"})]}),/*#__PURE__*/_jsx(Button,{onClick:showModal,style:{marginTop:6},icon:/*#__PURE__*/_jsx(PrinterOutlined,{}),children:\"Imprimir expediente\"}),/*#__PURE__*/_jsx(Modal,{title:\"Imprimir Expediente\",open:isModalOpen,onOk:handleOk,onCancel:handleCancel,width:900,children:/*#__PURE__*/_jsx(ExpedienteDocument,{pacienteData:paciente,expedienteData:expedientesData,notas:notas,recetas:recetas,historia:historiaDetails,citas:citas})}),/*#__PURE__*/_jsx(DownloadConscent,{})]});}","map":{"version":3,"names":["React","useState","useEffect","Button","Modal","message","API","getData","sendDataBody","DetalleNota","DetalleHistoria","DetallesPaciente","PrinterOutlined","CloudDownloadOutlined","ExpedienteDocument","jsx","_jsx","jsxs","_jsxs","Expedientes","_ref","paciente","setIsEditModalOpen","expedientesData","setExpedientesData","expedientesLoading","setExpedientesLoading","historia","setHistoria","historiaDetails","sethistoriaDetails","notas","setNotas","recetas","setRecetas","citas","setcitas","isModalOpen","setIsModalOpen","showModal","handleOk","handleCancel","_id","id_paciente","getExpedientesData","getPatientRegisters","fetch","concat","then","response","json","data","getHistoriaData","finally","rs","addHistoria","historial","Date","createPAtientData","usr","postBody","usuario","id_historia","success","error","DownloadConscent","icon","className","style","marginLeft","href","children","id","display","flexDirection","gap","detalles_paciente","id_expediente","prevExpNotas","datosPaciente","onClick","marginTop","title","open","onOk","onCancel","width","pacienteData","expedienteData"],"sources":["C:/Users/Gil/Documents/ReCreaMed/src/doctorViews/expedientes/expedientes.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Button, Modal, message } from 'antd';\r\nimport { API, getData, sendDataBody } from '../../resources';\r\nimport DetalleNota from './detalleNota'\r\nimport DetalleHistoria from './detalleHistoria';\r\nimport DetallesPaciente from '../pacientes/detalles.paciente';\r\nimport { PrinterOutlined, CloudDownloadOutlined } from '@ant-design/icons'\r\nimport ExpedienteDocument from './expedienteForPrint';\r\n// import html2canvas from 'html2canvas'; deprecated\r\n// import { jsPDF } from \"jspdf\";\r\n\r\n\r\nexport default function Expedientes({ paciente, setIsEditModalOpen }) {\r\n\r\n    const [expedientesData, setExpedientesData] = useState(null);\r\n    const [expedientesLoading, setExpedientesLoading] = useState(true);\r\n    const [historia, setHistoria] = useState(\"\");\r\n    const [historiaDetails, sethistoriaDetails] = useState(\"\")\r\n    const [notas, setNotas] = useState(\"\");\r\n    const [recetas, setRecetas] = useState(\"\");\r\n    const [citas, setcitas] = useState(\"\")\r\n\r\n    // Print modal\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const showModal = () => {\r\n        setIsModalOpen(true);\r\n    };\r\n    const handleOk = () => {\r\n        setIsModalOpen(false);\r\n    };\r\n    const handleCancel = () => {\r\n        setIsModalOpen(false);\r\n    };\r\n    // Print modal end\r\n\r\n    const { _id: id_paciente } = paciente;\r\n\r\n    useEffect(() => {\r\n        getExpedientesData(id_paciente)\r\n        getPatientRegisters(id_paciente)\r\n    }, [id_paciente])\r\n\r\n\r\n    const getExpedientesData = (id_paciente) => {\r\n        // console.log('Received patient exp doc ', id_paciente)\r\n        fetch(API + `expedientes/${id_paciente}`)\r\n            .then(response => response.json())\r\n            .then(data => {\r\n                // console.log(\"GetExpData: \", data);\r\n                setExpedientesData(data);\r\n                if (typeof data != \"undefined\" && data !== null) {\r\n                    // setNotas(data.notas); \r\n                    setHistoria(data.historia);\r\n                    getHistoriaData(data.historia)\r\n                } else { setNotas(null); setHistoria(null) }\r\n            })\r\n            .finally(() => setExpedientesLoading(false))\r\n    }\r\n\r\n    const getPatientRegisters = (id_paciente) => {\r\n        getData(`notas/${id_paciente}`).then(rs => setNotas(rs))\r\n        getData(`receta/${id_paciente}`).then(rs => setRecetas(rs))\r\n        getData(`citas/${id_paciente}`).then(rs => setcitas(rs))\r\n    }\r\n\r\n    const getHistoriaData = (historia) => {\r\n        getData(`historia/${historia}`).then(rs => { sethistoriaDetails(rs) })\r\n    }\r\n\r\n    async function addHistoria() {\r\n        return sendDataBody('historias/add', {\r\n            historial: \"Historia clinica al \" + new Date()\r\n        })\r\n    }\r\n\r\n    const createPAtientData = async (usr) => {\r\n        const historia = await addHistoria();\r\n        const postBody = {\r\n            usuario: usr,\r\n            historia: historia.id_historia,\r\n            notas: [],\r\n            recetas: []\r\n        }\r\n        // console.log('postBodyForExpedient: ', postBody);\r\n\r\n        sendDataBody('expedientes/add', postBody).then(response => {\r\n            // console.log('Success:', response);\r\n            message.success(response.message || response.error);\r\n            if (response.message && response.message === 'Expediente creado correctamente') {\r\n                getExpedientesData(id_paciente)\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    function DownloadConscent() {\r\n        // El archvo de conscentmiento se guardará en ./uploads y se llamara con /notas/estudos/download de momento porque no hay un endpoint para archivo de conscentimento para subrlo sera en /notas/estudus/upload\r\n        return <Button icon={<CloudDownloadOutlined className=\"teamSocialIcon\" />} style={{ marginLeft: 12 }} href={`${API}notas/estudios/download/3d4c9465-889f-428c-9e15-13bea15162ef.doc`}>\r\n            Avso de Conscentmiento\r\n        </Button>\r\n\r\n    }\r\n\r\n\r\n\r\n    if (expedientesLoading) return <p>Cargando...</p>\r\n\r\n    return <div id='expedient-export' >\r\n\r\n        {/* <h4 className='spacedTitle'>Expediente </h4> */}\r\n\r\n        <div style={{ display: 'flex', flexDirection: 'row', gap: 15 }}>\r\n            <DetallesPaciente paciente={paciente} setIsEditModalOpen={setIsEditModalOpen} />\r\n\r\n            <DetalleHistoria historia={historia} detalles_paciente={paciente} />\r\n\r\n        </div>\r\n\r\n\r\n        {\r\n            expedientesData ?\r\n                <DetalleNota id_expediente={expedientesData._id} prevExpNotas={expedientesData.notas} paciente={id_paciente} datosPaciente={paciente} />\r\n                :\r\n                <div style={{}}>\r\n                    Sin expediente\r\n                    <br />\r\n                    <br />\r\n                    <Button onClick={() => { createPAtientData(id_paciente) }}>Crear Expediente Ahora</Button>\r\n                </div>\r\n        }\r\n\r\n        <Button onClick={showModal} style={{ marginTop: 6 }} icon={<PrinterOutlined />}>Imprimir expediente</Button>\r\n\r\n\r\n        <Modal title=\"Imprimir Expediente\" open={isModalOpen} onOk={handleOk} onCancel={handleCancel} width={900}>\r\n            <ExpedienteDocument pacienteData={paciente} expedienteData={expedientesData} notas={notas} recetas={recetas} historia={historiaDetails} citas={citas}/>\r\n        </Modal>\r\n\r\n        <DownloadConscent />\r\n\r\n    </div>;\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}