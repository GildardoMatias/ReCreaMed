{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Button,Modal,message}from'antd';import{API,sendDataBody}from'../../resources';import DetalleNota from'./detalleNota';import DetalleHistoria from'./detalleHistoria';import DetallesPaciente from'../pacientes/detalles.paciente';import{PrinterOutlined,CloudDownloadOutlined}from'@ant-design/icons';import ExpedienteDocument from'./expedienteForPrint';// import html2canvas from 'html2canvas'; deprecated\n// import { jsPDF } from \"jspdf\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Expedientes(_ref){let{paciente,setIsEditModalOpen}=_ref;const[expedientesData,setExpedientesData]=useState(null);const[expedientesLoading,setExpedientesLoading]=useState(true);const[historia,setHistoria]=useState(\"\");const[notas,setNotas]=useState(\"\");// Print modal\nconst[isModalOpen,setIsModalOpen]=useState(false);const showModal=()=>{setIsModalOpen(true);};const handleOk=()=>{setIsModalOpen(false);};const handleCancel=()=>{setIsModalOpen(false);};// Print modal end\nconst{_id:id_paciente}=paciente;useEffect(()=>{getExpedientesData(id_paciente);},[id_paciente]);const getExpedientesData=id_paciente=>{// console.log('Received patient exp doc ', id_paciente)\nfetch(API+\"expedientes/\".concat(id_paciente)).then(response=>response.json()).then(data=>{// console.log(\"GetExpData: \", data);\nsetExpedientesData(data);if(typeof data!=\"undefined\"&&data!==null){setNotas(data.notas);setHistoria(data.historia);}else{setNotas(null);setHistoria(null);}}).finally(()=>setExpedientesLoading(false));};// const printDocument = () => {\n//     const input = document.getElementById('expedient-export');\n//     html2canvas(input)\n//         .then((canvas) => {\n//             const imgData = canvas.toDataURL('image/png');\n//             const pdf = new jsPDF();\n//             pdf.addImage(imgData, 'JPEG', 0, 0);\n//             pdf.output('dataurlnewwindow');//Name of file?\n//             pdf.save(\"expediente.pdf\");\n//         })\n//         ;\n// }\nasync function addHistoria(){return sendDataBody('historias/add',{historial:\"Historia clinica al \"+new Date()});}const createPAtientData=async usr=>{const historia=await addHistoria();const postBody={usuario:usr,historia:historia.id_historia,notas:[],recetas:[]};// console.log('postBodyForExpedient: ', postBody);\nsendDataBody('expedientes/add',postBody).then(response=>{// console.log('Success:', response);\nmessage.success(response.message||response.error);if(response.message&&response.message==='Expediente creado correctamente'){getExpedientesData(id_paciente);}});};function DownloadConscent(){// El archvo de conscentmiento se guardará en ./uploads y se llamara con /notas/estudos/download de momento porque no hay un endpoint para archivo de conscentimento para subrlo sera en /notas/estudus/upload\nreturn/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(CloudDownloadOutlined,{className:\"teamSocialIcon\"}),style:{marginLeft:12},href:\"\".concat(API,\"notas/estudios/download/3d4c9465-889f-428c-9e15-13bea15162ef.doc\"),children:\"Avso de Conscentmiento\"});}if(expedientesLoading)return/*#__PURE__*/_jsx(\"p\",{children:\"Cargando...\"});return/*#__PURE__*/_jsxs(\"div\",{id:\"expedient-export\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'row',gap:15},children:[/*#__PURE__*/_jsx(DetallesPaciente,{paciente:paciente,setIsEditModalOpen:setIsEditModalOpen}),/*#__PURE__*/_jsx(DetalleHistoria,{historia:historia,detalles_paciente:paciente})]}),expedientesData?/*#__PURE__*/_jsx(DetalleNota,{id_expediente:expedientesData._id,prevExpNotas:expedientesData.notas,paciente:id_paciente,datosPaciente:paciente}):/*#__PURE__*/_jsxs(\"div\",{style:{},children:[\"Sin expediente\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{onClick:()=>{createPAtientData(id_paciente);},children:\"Crear Expediente Ahora\"})]}),/*#__PURE__*/_jsx(Button,{onClick:showModal,style:{marginTop:6},icon:/*#__PURE__*/_jsx(PrinterOutlined,{}),children:\"Imprimir expediente\"}),/*#__PURE__*/_jsx(Modal,{title:\"Imprimir Expediente\",open:isModalOpen,onOk:handleOk,onCancel:handleCancel,width:900,children:/*#__PURE__*/_jsx(ExpedienteDocument,{pacienteData:{name:'patient',phone:123456},expedienteData:{notas:[],other:[]}})}),/*#__PURE__*/_jsx(DownloadConscent,{})]});}","map":{"version":3,"names":["React","useState","useEffect","Button","Modal","message","API","sendDataBody","DetalleNota","DetalleHistoria","DetallesPaciente","PrinterOutlined","CloudDownloadOutlined","ExpedienteDocument","jsx","_jsx","jsxs","_jsxs","Expedientes","_ref","paciente","setIsEditModalOpen","expedientesData","setExpedientesData","expedientesLoading","setExpedientesLoading","historia","setHistoria","notas","setNotas","isModalOpen","setIsModalOpen","showModal","handleOk","handleCancel","_id","id_paciente","getExpedientesData","fetch","concat","then","response","json","data","finally","addHistoria","historial","Date","createPAtientData","usr","postBody","usuario","id_historia","recetas","success","error","DownloadConscent","icon","className","style","marginLeft","href","children","id","display","flexDirection","gap","detalles_paciente","id_expediente","prevExpNotas","datosPaciente","onClick","marginTop","title","open","onOk","onCancel","width","pacienteData","name","phone","expedienteData","other"],"sources":["C:/Users/Gil/Documents/ReCreaMed/src/doctorViews/expedientes/expedientes.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Button, Modal, message } from 'antd';\r\nimport { API, sendDataBody } from '../../resources';\r\nimport DetalleNota from './detalleNota'\r\nimport DetalleHistoria from './detalleHistoria';\r\nimport DetallesPaciente from '../pacientes/detalles.paciente';\r\nimport { PrinterOutlined, CloudDownloadOutlined } from '@ant-design/icons'\r\nimport ExpedienteDocument from './expedienteForPrint';\r\n// import html2canvas from 'html2canvas'; deprecated\r\n// import { jsPDF } from \"jspdf\";\r\n\r\n\r\nexport default function Expedientes({ paciente, setIsEditModalOpen }) {\r\n    const [expedientesData, setExpedientesData] = useState(null);\r\n    const [expedientesLoading, setExpedientesLoading] = useState(true);\r\n    const [historia, setHistoria] = useState(\"\");\r\n    const [notas, setNotas] = useState(\"\");\r\n\r\n    // Print modal\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const showModal = () => {\r\n        setIsModalOpen(true);\r\n    };\r\n    const handleOk = () => {\r\n        setIsModalOpen(false);\r\n    };\r\n    const handleCancel = () => {\r\n        setIsModalOpen(false);\r\n    };\r\n    // Print modal end\r\n\r\n    const { _id: id_paciente } = paciente;\r\n\r\n    useEffect(() => {\r\n        getExpedientesData(id_paciente)\r\n    }, [id_paciente])\r\n\r\n\r\n    const getExpedientesData = (id_paciente) => {\r\n        // console.log('Received patient exp doc ', id_paciente)\r\n        fetch(API + `expedientes/${id_paciente}`)\r\n            .then(response => response.json())\r\n            .then(data => {\r\n                // console.log(\"GetExpData: \", data);\r\n                setExpedientesData(data);\r\n                if (typeof data != \"undefined\" && data !== null) {\r\n                    setNotas(data.notas); setHistoria(data.historia);\r\n                } else { setNotas(null); setHistoria(null) }\r\n            })\r\n            .finally(() => setExpedientesLoading(false))\r\n    }\r\n\r\n    // const printDocument = () => {\r\n    //     const input = document.getElementById('expedient-export');\r\n    //     html2canvas(input)\r\n    //         .then((canvas) => {\r\n    //             const imgData = canvas.toDataURL('image/png');\r\n    //             const pdf = new jsPDF();\r\n    //             pdf.addImage(imgData, 'JPEG', 0, 0);\r\n    //             pdf.output('dataurlnewwindow');//Name of file?\r\n    //             pdf.save(\"expediente.pdf\");\r\n    //         })\r\n    //         ;\r\n    // }\r\n\r\n\r\n    async function addHistoria() {\r\n        return sendDataBody('historias/add', {\r\n            historial: \"Historia clinica al \" + new Date()\r\n        })\r\n    }\r\n\r\n    const createPAtientData = async (usr) => {\r\n        const historia = await addHistoria();\r\n        const postBody = {\r\n            usuario: usr,\r\n            historia: historia.id_historia,\r\n            notas: [],\r\n            recetas: []\r\n        }\r\n        // console.log('postBodyForExpedient: ', postBody);\r\n\r\n        sendDataBody('expedientes/add', postBody).then(response => {\r\n            // console.log('Success:', response);\r\n            message.success(response.message || response.error);\r\n            if (response.message && response.message === 'Expediente creado correctamente') {\r\n                getExpedientesData(id_paciente)\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    function DownloadConscent() {\r\n        // El archvo de conscentmiento se guardará en ./uploads y se llamara con /notas/estudos/download de momento porque no hay un endpoint para archivo de conscentimento para subrlo sera en /notas/estudus/upload\r\n        return <Button icon={<CloudDownloadOutlined className=\"teamSocialIcon\" />} style={{ marginLeft: 12 }} href={`${API}notas/estudios/download/3d4c9465-889f-428c-9e15-13bea15162ef.doc`}>\r\n            Avso de Conscentmiento\r\n        </Button>\r\n\r\n    }\r\n\r\n\r\n\r\n    if (expedientesLoading) return <p>Cargando...</p>\r\n\r\n    return <div id='expedient-export' >\r\n\r\n        {/* <h4 className='spacedTitle'>Expediente </h4> */}\r\n\r\n        <div style={{ display: 'flex', flexDirection: 'row', gap: 15 }}>\r\n            <DetallesPaciente paciente={paciente} setIsEditModalOpen={setIsEditModalOpen} />\r\n\r\n            <DetalleHistoria historia={historia} detalles_paciente={paciente} />\r\n        </div>\r\n\r\n\r\n\r\n\r\n        {\r\n            expedientesData ?\r\n                <DetalleNota id_expediente={expedientesData._id} prevExpNotas={expedientesData.notas} paciente={id_paciente} datosPaciente={paciente} />\r\n                :\r\n                <div style={{}}>\r\n                    Sin expediente\r\n                    <br />\r\n                    <br />\r\n                    <Button onClick={() => { createPAtientData(id_paciente) }}>Crear Expediente Ahora</Button>\r\n                </div>\r\n        }\r\n\r\n        <Button onClick={showModal} style={{ marginTop: 6 }} icon={<PrinterOutlined />}>Imprimir expediente</Button>\r\n\r\n\r\n        <Modal title=\"Imprimir Expediente\" open={isModalOpen} onOk={handleOk} onCancel={handleCancel} width={900}>\r\n            <ExpedienteDocument pacienteData={{name: 'patient', phone: 123456}} expedienteData={{ notas: [], other: [] }} />\r\n        </Modal>\r\n\r\n        <DownloadConscent />\r\n\r\n    </div>;\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}