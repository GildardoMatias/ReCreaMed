{"ast":null,"code":"import { arc } from 'd3-shape';\nimport { Path, convertToPath, CSS, PropertySyntax } from '@antv/g';\nimport { isTranspose, isPolar } from '../utils/coordinate';\nimport { getArcObject } from '../shape/utils';\n/**\n * Scale mark from nothing to desired shape in y direction.\n */\nexport const ScaleInY = (options, context) => {\n  // Small enough to hide or show very small part of mark,\n  // but bigger enough to not cause bug.\n  const ZERO = 0.0001;\n  const {\n    coordinate\n  } = context;\n  // the polar coordinate need\n  CSS.registerProperty({\n    name: 'scaleInYRadius',\n    inherits: false,\n    initialValue: '',\n    interpolable: true,\n    syntax: PropertySyntax.NUMBER\n  });\n  return (from, _, defaults) => {\n    const [shape] = from;\n    const PolarScaleInY = shape => {\n      const {\n        __data__,\n        style\n      } = shape;\n      const {\n        radius = 0,\n        inset = 0,\n        fillOpacity = 1,\n        strokeOpacity = 1,\n        opacity = 1\n      } = style;\n      const {\n        points,\n        y,\n        y1\n      } = __data__;\n      const arcObject = getArcObject(coordinate, points, [y, y1]);\n      const {\n        innerRadius,\n        outerRadius\n      } = arcObject;\n      const path = arc().cornerRadius(radius).padAngle(inset * Math.PI / 180);\n      const pathForConversion = new Path({});\n      const center = coordinate.getCenter();\n      const createArcPath = arcParams => {\n        pathForConversion.attr({\n          d: path(arcParams),\n          transform: \"translate(\".concat(center[0], \", \").concat(center[1], \")\")\n        });\n        const convertedPathDefinition = convertToPath(pathForConversion);\n        pathForConversion.style.transform = '';\n        return convertedPathDefinition;\n      };\n      const keyframes = [{\n        scaleInYRadius: innerRadius + ZERO,\n        fillOpacity: 0,\n        strokeOpacity: 0,\n        opacity: 0\n      }, {\n        scaleInYRadius: innerRadius + ZERO,\n        fillOpacity,\n        strokeOpacity,\n        opacity,\n        offset: 0.01\n      }, {\n        scaleInYRadius: outerRadius,\n        fillOpacity,\n        strokeOpacity,\n        opacity\n      }];\n      const animation = shape.animate(keyframes, Object.assign(Object.assign({}, defaults), options));\n      animation.onframe = function () {\n        shape.style.path = createArcPath(Object.assign(Object.assign({}, arcObject), {\n          outerRadius: Number(shape.style.scaleInYRadius)\n        }));\n      };\n      animation.onfinish = function () {\n        shape.style.path = createArcPath(Object.assign(Object.assign({}, arcObject), {\n          outerRadius: outerRadius\n        }));\n      };\n      return animation;\n    };\n    const RectangularScaleInY = shape => {\n      const {\n        style\n      } = shape;\n      const {\n        transform: prefix = '',\n        fillOpacity = 1,\n        strokeOpacity = 1,\n        opacity = 1\n      } = style;\n      const [transformOrigin, transform] = isTranspose(coordinate) ? [\"left top\", \"scale(\".concat(ZERO, \", 1)\")] // left-top corner\n      : [\"left bottom\", \"scale(1, \".concat(ZERO, \")\")]; // left-bottom corner\n      // Using a short fadeIn transition to hide element with scale(0.001)\n      // which is still visible.\n      const keyframes = [{\n        transform: \"\".concat(prefix, \" \").concat(transform).trimStart(),\n        transformOrigin,\n        fillOpacity: 0,\n        strokeOpacity: 0,\n        opacity: 0\n      }, {\n        transform: \"\".concat(prefix, \" \").concat(transform).trimStart(),\n        transformOrigin,\n        fillOpacity,\n        strokeOpacity,\n        opacity,\n        offset: 0.01\n      }, {\n        transform: \"\".concat(prefix, \" scale(1, 1)\").trimStart(),\n        transformOrigin,\n        fillOpacity,\n        strokeOpacity,\n        opacity\n      }];\n      const animation = shape.animate(keyframes, Object.assign(Object.assign({}, defaults), options));\n      return animation;\n    };\n    if (isPolar(coordinate)) {\n      return PolarScaleInY(shape);\n    } else {\n      return RectangularScaleInY(shape);\n    }\n  };\n};","map":{"version":3,"names":["arc","Path","convertToPath","CSS","PropertySyntax","isTranspose","isPolar","getArcObject","ScaleInY","options","context","ZERO","coordinate","registerProperty","name","inherits","initialValue","interpolable","syntax","NUMBER","from","_","defaults","shape","PolarScaleInY","__data__","style","radius","inset","fillOpacity","strokeOpacity","opacity","points","y","y1","arcObject","innerRadius","outerRadius","path","cornerRadius","padAngle","Math","PI","pathForConversion","center","getCenter","createArcPath","arcParams","attr","d","transform","concat","convertedPathDefinition","keyframes","scaleInYRadius","offset","animation","animate","Object","assign","onframe","Number","onfinish","RectangularScaleInY","prefix","transformOrigin","trimStart"],"sources":["src/animation/scaleInY.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module"}