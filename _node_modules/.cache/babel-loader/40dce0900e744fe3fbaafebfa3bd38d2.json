{"ast":null,"code":"import { Linear } from '@antv/scale';\nimport { isNumber, lowerFirst } from '@antv/util';\nimport { extent } from 'd3-array';\nimport { indexOf } from '../utils/array';\nimport { isPolar, isTranspose } from '../utils/coordinate';\nimport { angle, angleWithQuadrant, dist, sub } from '../utils/vector';\nexport function applyStyle(selection, style) {\n  for (const [key, value] of Object.entries(style)) {\n    selection.style(key, value);\n  }\n}\n/**\n * Draw polygon path with points.\n * @param path\n * @param points\n */\nexport function appendPolygon(path, points) {\n  points.forEach((p, idx) => idx === 0 ? path.moveTo(p[0], p[1]) : path.lineTo(p[0], p[1]));\n  path.closePath();\n  return path;\n}\n/**\n * Draw arrow between `from` and `to`.\n * @param from\n * @param to\n * @returns\n */\nexport function arrowPoints(from, to, options) {\n  const {\n    arrowSize\n  } = options;\n  const size = typeof arrowSize === 'string' ? +parseFloat(arrowSize) / 100 * dist(from, to) : arrowSize;\n  // TODO Use config from style.\n  // Default arrow rotate is 30Â°.\n  const arrowAngle = Math.PI / 6;\n  const angle = Math.atan2(to[1] - from[1], to[0] - from[0]);\n  const arrowAngle1 = Math.PI / 2 - angle - arrowAngle;\n  const arrow1 = [to[0] - size * Math.sin(arrowAngle1), to[1] - size * Math.cos(arrowAngle1)];\n  const arrowAngle2 = angle - arrowAngle;\n  const arrow2 = [to[0] - size * Math.cos(arrowAngle2), to[1] - size * Math.sin(arrowAngle2)];\n  return [arrow1, arrow2];\n}\n/**\n * Draw arc by from -> to, with center and radius.\n * @param path\n * @param from\n * @param to\n * @param center\n * @param radius\n */\nexport function appendArc(path, from, to, center, radius) {\n  const startAngle = angle(sub(center, from)) + Math.PI;\n  const endAngle = angle(sub(center, to)) + Math.PI;\n  path.arc(center[0], center[1], radius, startAngle, endAngle, endAngle - startAngle < 0);\n  return path;\n}\n/**\n * @todo Fix wrong key point.\n */\nexport function computeGradient(C, X, Y) {\n  let from = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 'y';\n  let mode = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 'between';\n  let tpShape = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;\n  // The angles of gradients rendering are varies when 'from' and 'tpShape' are different.\n  const getTheta = (from, tpShape) => {\n    if (from === 'y' || from === true) {\n      if (tpShape) {\n        return 180;\n      } else {\n        return 90;\n      }\n    } else {\n      if (tpShape) {\n        return 90;\n      } else {\n        return 0;\n      }\n    }\n  };\n  const P = from === 'y' || from === true ? Y : X;\n  const theta = getTheta(from, tpShape);\n  const I = indexOf(P);\n  const [min, max] = extent(I, i => P[i]);\n  // This need to improve for non-uniform distributed colors.\n  const p = new Linear({\n    domain: [min, max],\n    range: [0, 100]\n  });\n  const percentage = i => isNumber(P[i]) && !Number.isNaN(P[i]) ? p.map(P[i]) : 0;\n  const gradientMode = {\n    // Interpolate the colors for this segment.\n    between: i => \"\".concat(C[i], \" \").concat(percentage(i), \"%\"),\n    // Use the color of the start point as the color for this segment.\n    start: i => i === 0 ? \"\".concat(C[i], \" \").concat(percentage(i), \"%\") : \"\".concat(C[i - 1], \" \").concat(percentage(i), \"%, \").concat(C[i], \" \").concat(percentage(i), \"%\"),\n    // Use the color of the end point as the color for this segment.\n    end: i => i === C.length - 1 ? \"\".concat(C[i], \" \").concat(percentage(i), \"%\") : \"\".concat(C[i], \" \").concat(percentage(i), \"%, \").concat(C[i + 1], \" \").concat(percentage(i), \"%\")\n  };\n  const gradient = I.sort((a, b) => percentage(a) - percentage(b)).map(gradientMode[mode] || gradientMode['between']).join(',');\n  return \"linear-gradient(\".concat(theta, \"deg, \").concat(gradient, \")\");\n}\nexport function reorder(points) {\n  const [p0, p1, p2, p3] = points;\n  return [p3, p0, p1, p2];\n}\nexport function getArcObject(coordinate, points, Y) {\n  const [p0, p1,, p3] = isTranspose(coordinate) ? reorder(points) : points;\n  const [y, y1] = Y;\n  const center = coordinate.getCenter();\n  const a1 = angleWithQuadrant(sub(p0, center));\n  const a2 = angleWithQuadrant(sub(p1, center));\n  // There are two situations that a2 === a1:\n  // 1. a1 - a2 = 0\n  // 2. |a1 - a2| = Math.PI * 2\n  // Distinguish them by y and y1:\n  const a3 = a2 === a1 && y !== y1 ? a2 + Math.PI * 2 : a2;\n  return {\n    startAngle: a1,\n    endAngle: a3 - a1 >= 0 ? a3 : Math.PI * 2 + a3,\n    innerRadius: dist(p3, center),\n    outerRadius: dist(p0, center)\n  };\n}\n/**\n * Pick connectStyle from style.\n * @param style\n */\nexport function getConnectStyle(style) {\n  const PREFIX = 'connect';\n  return Object.fromEntries(Object.entries(style).filter(_ref => {\n    let [key] = _ref;\n    return key.startsWith(PREFIX);\n  }).map(_ref2 => {\n    let [key, value] = _ref2;\n    return [lowerFirst(key.replace(PREFIX, '').trim()), value];\n  }).filter(_ref3 => {\n    let [key] = _ref3;\n    return key !== undefined;\n  }));\n}\nexport function toOpacityKey(options) {\n  const {\n    colorAttribute,\n    opacityAttribute = colorAttribute\n  } = options;\n  return \"\".concat(opacityAttribute, \"Opacity\");\n}\nexport function getTransform(coordinate, value) {\n  if (!isPolar(coordinate)) return '';\n  const center = coordinate.getCenter();\n  const {\n    transform: suffix\n  } = value;\n  return \"translate(\".concat(center[0], \", \").concat(center[1], \") \").concat(suffix || '');\n}\nexport function getOrigin(points) {\n  if (points.length === 1) return points[0];\n  const [[x0, y0, z0 = 0], [x2, y2, z2 = 0]] = points;\n  return [(x0 + x2) / 2, (y0 + y2) / 2, (z0 + z2) / 2];\n}","map":{"version":3,"names":["Linear","isNumber","lowerFirst","extent","indexOf","isPolar","isTranspose","angle","angleWithQuadrant","dist","sub","applyStyle","selection","style","key","value","Object","entries","appendPolygon","path","points","forEach","p","idx","moveTo","lineTo","closePath","arrowPoints","from","to","options","arrowSize","size","parseFloat","arrowAngle","Math","PI","atan2","arrowAngle1","arrow1","sin","cos","arrowAngle2","arrow2","appendArc","center","radius","startAngle","endAngle","arc","computeGradient","C","X","Y","arguments","length","undefined","mode","tpShape","getTheta","P","theta","I","min","max","i","domain","range","percentage","Number","isNaN","map","gradientMode","between","concat","start","end","gradient","sort","a","b","join","reorder","p0","p1","p2","p3","getArcObject","coordinate","y","y1","getCenter","a1","a2","a3","innerRadius","outerRadius","getConnectStyle","PREFIX","fromEntries","filter","_ref","startsWith","_ref2","replace","trim","_ref3","toOpacityKey","colorAttribute","opacityAttribute","getTransform","transform","suffix","getOrigin","x0","y0","z0","x2","y2","z2"],"sources":["src/shape/utils.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module"}