{"ast":null,"code":"import React,{useEffect,useState}from'react';import{getData,updateData}from'../../resources';import{Card,Typography}from'antd';import{CalendarOutlined,ClockCircleOutlined,DollarOutlined}from'@ant-design/icons';import HistorialCitas from'./historialCitas';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const{Paragraph}=Typography;export default function LastCita(props){const[cita,setCita]=useState({});const[citasData,setCitasData]=useState({});const[lastBalance,setLastBalance]=useState([]);// const [editableStr, setEditableStr] = useState('Sin costo registrado');\nconst[loading,setLoading]=useState(true);useEffect(()=>{getCitasData();},[]);const updateLastBalance=newMonto=>{let newLastBalance=lastBalance;newLastBalance.monto=newMonto;updateData(\"balances/update/\".concat(lastBalance._id),newLastBalance).then(getCitasData);};const getLastCta=eventos=>{var fechaActual=new Date();// Filtrar los eventos que tienen una fecha menor o igual a la fecha actual\nvar eventosPasados=eventos.filter(function(evento){var fechaEvento=new Date(evento.fecha_hora);return fechaEvento<=fechaActual;});// Ordenar los eventos pasados por fecha de forma descendente\neventosPasados.sort(function(a,b){var fechaA=new Date(a.fecha_hora);var fechaB=new Date(b.fecha_hora);return fechaB-fechaA;});// Obtener el evento más reciente\nreturn eventosPasados[0];};const getCitasData=()=>{getData(\"citas/\".concat(props.paciente)).then(rs=>{const ultimaCita=getLastCta(rs);// console.log('lsat cita', ultimaCita)\nsetCita(ultimaCita);setCitasData(rs);return ultimaCita;}).then(last=>{return getData('balances/cita/'+(last===null||last===void 0?void 0:last._id));}).then(bl=>{// console.log('balance', bl)\nsetLastBalance(bl[0]);}).finally(()=>setLoading(false));};const LastBalance=()=>{return/*#__PURE__*/_jsx(\"div\",{children:lastBalance&&lastBalance.monto?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'row',alignItems:'center',columnGap:'10px'},children:[/*#__PURE__*/_jsx(DollarOutlined,{style:{}}),\"Costo:\",/*#__PURE__*/_jsx(Paragraph,{style:{marginTop:14},editable:{onChange:updateLastBalance},children:lastBalance.monto})]}),/*#__PURE__*/_jsx(HistorialCitas,{historial:citasData})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Sin Ultimo Balance\"})});};if(loading)return/*#__PURE__*/_jsx(\"p\",{children:\"Cargando...\"});return/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8},children:/*#__PURE__*/_jsx(Card,{children:cita?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h6\",{children:\"Cita m\\xE1s reciente\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsxs(\"li\",{className:\"btnIconCentered\",children:[/*#__PURE__*/_jsx(CalendarOutlined,{style:{marginRight:8}}),\" Fecha: \",new Date(cita.fecha_hora).toLocaleDateString()]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"li\",{className:\"btnIconCentered\",children:[/*#__PURE__*/_jsx(ClockCircleOutlined,{style:{marginRight:8}}),\" Hora: \",cita.fecha_hora.substring(11,16)]}),/*#__PURE__*/_jsx(LastBalance,{})]})]}):/*#__PURE__*/_jsx(\"h6\",{children:\"Sin cita recente registrada\"})})});}","map":{"version":3,"names":["React","useEffect","useState","getData","updateData","Card","Typography","CalendarOutlined","ClockCircleOutlined","DollarOutlined","HistorialCitas","jsx","_jsx","jsxs","_jsxs","Paragraph","LastCita","props","cita","setCita","citasData","setCitasData","lastBalance","setLastBalance","loading","setLoading","getCitasData","updateLastBalance","newMonto","newLastBalance","monto","concat","_id","then","getLastCta","eventos","fechaActual","Date","eventosPasados","filter","evento","fechaEvento","fecha_hora","sort","a","b","fechaA","fechaB","paciente","rs","ultimaCita","last","bl","finally","LastBalance","children","style","display","flexDirection","alignItems","columnGap","marginTop","editable","onChange","historial","className","marginRight","toLocaleDateString","substring"],"sources":["C:/Users/Gil/Documents/ReCreaMed/src/doctorViews/expedientes/lastCita.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { getData, updateData } from '../../resources'\r\nimport { Card, Typography } from 'antd'\r\nimport { CalendarOutlined, ClockCircleOutlined, DollarOutlined } from '@ant-design/icons'\r\nimport HistorialCitas from './historialCitas';\r\nconst { Paragraph } = Typography;\r\n\r\n\r\nexport default function LastCita(props) {\r\n\r\n    const [cita, setCita] = useState({})\r\n    const [citasData, setCitasData] = useState({})\r\n    const [lastBalance, setLastBalance] = useState([])\r\n    // const [editableStr, setEditableStr] = useState('Sin costo registrado');\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    useEffect(() => { getCitasData() }, [])\r\n\r\n    const updateLastBalance = (newMonto) => {\r\n\r\n        let newLastBalance = lastBalance;\r\n        newLastBalance.monto = newMonto;\r\n        updateData(`balances/update/${lastBalance._id}`, newLastBalance).then(getCitasData)\r\n    }\r\n\r\n    const getLastCta = (eventos) => {\r\n        var fechaActual = new Date();\r\n\r\n        // Filtrar los eventos que tienen una fecha menor o igual a la fecha actual\r\n        var eventosPasados = eventos.filter(function (evento) {\r\n            var fechaEvento = new Date(evento.fecha_hora);\r\n            return fechaEvento <= fechaActual;\r\n        });\r\n\r\n        // Ordenar los eventos pasados por fecha de forma descendente\r\n        eventosPasados.sort(function (a, b) {\r\n            var fechaA = new Date(a.fecha_hora);\r\n            var fechaB = new Date(b.fecha_hora);\r\n            return fechaB - fechaA;\r\n        });\r\n\r\n        // Obtener el evento más reciente\r\n        return eventosPasados[0]\r\n    }\r\n\r\n    const getCitasData = () => {\r\n        getData(`citas/${props.paciente}`).then((rs) => {\r\n            const ultimaCita = getLastCta(rs);\r\n            // console.log('lsat cita', ultimaCita)\r\n            setCita(ultimaCita)\r\n            setCitasData(rs)\r\n            return ultimaCita\r\n        }).then((last) => {\r\n            return getData('balances/cita/' + last?._id)\r\n        }).then((bl) => {\r\n            // console.log('balance', bl)\r\n            setLastBalance(bl[0])\r\n        }).finally(() => setLoading(false))\r\n    }\r\n\r\n    const LastBalance = () => {\r\n        return <div>\r\n            {\r\n                lastBalance && lastBalance.monto ?\r\n                    (\r\n                        <div >\r\n\r\n                            <div style={{ display: 'flex', flexDirection: 'row', alignItems: 'center', columnGap: '10px' }}>\r\n                                <DollarOutlined style={{}} />\r\n                                Costo:\r\n                                <Paragraph\r\n                                    style={{ marginTop: 14 }}\r\n                                    editable={{\r\n                                        onChange: updateLastBalance,\r\n                                    }}\r\n                                >\r\n                                    {lastBalance.monto}\r\n                                </Paragraph>\r\n\r\n\r\n                            </div>\r\n                            <HistorialCitas historial={citasData} />\r\n                            {/* <div style={{ display: 'flex', flexDirection: 'row', alignItems: 'center', columnGap: '10px' }}>\r\n                             <CalendarOutlined /> {new Date(lastBalance.createdAt).toLocaleDateString()}\r\n                         </div> */}\r\n                        </div>\r\n                    ) : (\r\n                        <p>Sin Ultimo Balance</p>\r\n                    )\r\n            }\r\n\r\n        </div>\r\n    }\r\n\r\n\r\n    if (loading) return <p>Cargando...</p>\r\n    return (\r\n        <div style={{ marginTop: 8 }}>\r\n            <Card>\r\n                {\r\n                    cita ? <div>\r\n                        <h6>Cita más reciente</h6>\r\n                        <ul>\r\n                            <li className='btnIconCentered'><CalendarOutlined style={{ marginRight: 8 }} /> Fecha: {new Date(cita.fecha_hora).toLocaleDateString()}</li><br />\r\n\r\n                            <li className='btnIconCentered'><ClockCircleOutlined style={{ marginRight: 8 }} /> Hora: {cita.fecha_hora.substring(11, 16)}</li>\r\n\r\n                            <LastBalance />\r\n\r\n                        </ul>\r\n                    </div> : <h6>Sin cita recente registrada</h6>\r\n                }\r\n\r\n            </Card>\r\n        </div>\r\n    )\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}