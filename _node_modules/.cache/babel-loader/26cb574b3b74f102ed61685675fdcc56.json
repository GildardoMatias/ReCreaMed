{"ast":null,"code":"import { deepMix } from '@antv/util';\nimport { defined } from '../utils/helper';\nimport { columnOf } from './utils/helper';\nfunction normalizeValue(value) {\n  if (typeof value === 'object') return [value.value, value.ordinal];else return [value, true];\n}\n/**\n * The Filter transform filter channels.\n */\nexport const Filter = function () {\n  let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return (I, mark) => {\n    const {\n      encode,\n      data\n    } = mark;\n    const filters = Object.entries(options).map(_ref => {\n      let [key, v] = _ref;\n      const [V] = columnOf(encode, key);\n      // Skip empty channel.\n      if (!V) return null;\n      const [value, ordinal = true] = normalizeValue(v);\n      if (typeof value === 'function') return i => value(V[i]);\n      if (ordinal) {\n        const expectedValues = Array.isArray(value) ? value : [value];\n        // Skip empty expected values.\n        if (expectedValues.length === 0) return null;\n        return i => expectedValues.includes(V[i]);\n      } else {\n        const [start, end] = value;\n        return i => V[i] >= start && V[i] <= end;\n      }\n    }).filter(defined);\n    // Skip empty filters.\n    if (filters.length === 0) return [I, mark];\n    // Filter index and channels.\n    const totalFilter = i => filters.every(f => f(i));\n    const FI = I.filter(totalFilter);\n    const newIndex = FI.map((_, i) => i);\n    const newEncodes = Object.entries(encode).map(_ref2 => {\n      let [key, encode] = _ref2;\n      return [key, Object.assign(Object.assign({}, encode), {\n        value: newIndex.map(i => encode.value[FI[i]]).filter(v => v !== undefined)\n      })];\n    });\n    return [newIndex, deepMix({}, mark, {\n      encode: Object.fromEntries(newEncodes),\n      // Filter data for tooltip item.\n      data: FI.map(i => data[i])\n    })];\n  };\n};\nFilter.props = {};","map":{"version":3,"names":["deepMix","defined","columnOf","normalizeValue","value","ordinal","Filter","options","arguments","length","undefined","I","mark","encode","data","filters","Object","entries","map","_ref","key","v","V","i","expectedValues","Array","isArray","includes","start","end","filter","totalFilter","every","f","FI","newIndex","_","newEncodes","_ref2","fromEntries","props"],"sources":["src/transform/filter.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module"}