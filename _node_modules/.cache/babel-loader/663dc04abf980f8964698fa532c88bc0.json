{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Modal,Popconfirm,message}from'antd';import{deleteData,getData,sendDataBody}from'../../resources';import{CreateCitaForm}from'./create-cita-for-medic';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function DetailsCita(_ref){let{citaForEdit,isModalOpen,setIsModalOpen,getCitasData,id_hospital,pacientesData}=_ref;const{_id:id_cita,medico:id_medico,servicio}=citaForEdit;const[citaPaid,setCitaPaid]=useState(false);const[editingCita,setEditingCita]=useState(false);const handleOk=()=>{setIsModalOpen(false);setEditingCita(false);};const handleCancel=()=>{setIsModalOpen(false);setEditingCita(false);};//Check if paid before show confirm button\nuseEffect(()=>{checkPayment(citaForEdit._id);},[citaForEdit]);const checkPayment=id_cita=>{getData(\"balances/cita/\".concat(id_cita)).then(rs=>{if(rs.length>0){setCitaPaid(true);}else setCitaPaid(false);});};// Delete button\nconst confirm=e=>{deleteData(\"citas/remove/\".concat(citaForEdit._id)).then(rs=>{console.log(rs);getCitasData();handleCancel();});deleteData(\"balances/remove/cita/\".concat(citaForEdit._id));};const cancel=e=>{console.log(e);};//Confirm payment\nconst confirmPayment=e=>{const balanceBody={tipo:'ingreso',medico:id_medico,cita:id_cita,monto:getAmmount(servicio),abono:getAmmount(servicio),forma_de_pago:'Efectivo',fecha_hora:new Date(),estado:'pendiente',concepto:servicio};console.log('Balance ready to send: ',balanceBody);sendDataBody('balances/add',balanceBody).then(rs=>{message.success(rs.message||rs.error);checkPayment(id_cita);});};const getAmmount=str=>{const match=str.match(/\\$\\d+/);if(match){// Eliminamos el signo de dólar para obtener solo el número\nconst number=match[0].replace('$','');return number;}else{return 0;}};return/*#__PURE__*/_jsx(Modal,{title:\"Detalles Cita\",open:isModalOpen,onOk:handleOk,onCancel:handleCancel,destroyOnClose:true,width:900,footer:[/*#__PURE__*/_jsx(Popconfirm,{title:\"Eliminar Cita\",description:\"Seguro que quiere eliminar la cita?\",onConfirm:confirm,onCancel:cancel,okText:\"Si\",cancelText:\"No\",children:/*#__PURE__*/_jsx(Button,{danger:true,children:\"Eliminar\"})}),!citaPaid&&/*#__PURE__*/_jsx(Popconfirm,{title:\"Confirmar pago\",description:\"Recibi\\xF3 el pago correspondiente?\",onConfirm:confirmPayment,onCancel:cancel,okText:\"Si\",cancelText:\"No\",children:/*#__PURE__*/_jsx(Button,{children:\"Confirmar pago\"})}),/*#__PURE__*/_jsx(Button,{onClick:()=>setEditingCita(!editingCita),children:editingCita?\"Cancelar\":\"Modificar\"}),/*#__PURE__*/_jsx(Button,{onClick:handleCancel,children:\"Cerrar\"})],children:editingCita?/*#__PURE__*/_jsx(CreateCitaForm,{cita:citaForEdit,setIsModalOpen:setIsModalOpen,getCitasData:getCitasData,setEditingCita:setEditingCita,hospital:id_hospital,pacientesData:pacientesData}):/*#__PURE__*/_jsx(\"div\",{children:citaForEdit&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Medico \"}),citaForEdit.doctor?citaForEdit.doctor.name:'Sin medico']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Paciente \"}),citaForEdit.paciente?citaForEdit.paciente.name:'Sin paciente']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Fecha \"}),new Date(citaForEdit.fecha_hora).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Hora \"}),new Date(citaForEdit.fecha_hora).toLocaleTimeString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Servicio \"}),citaForEdit.servicio]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Comentarios \"}),citaForEdit.comentarios]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Color \"}),\" \",/*#__PURE__*/_jsx(\"div\",{style:{width:18,height:8,backgroundColor:citaForEdit.color}}),\" \"]})]})})});}","map":{"version":3,"names":["React","useEffect","useState","Button","Modal","Popconfirm","message","deleteData","getData","sendDataBody","CreateCitaForm","jsx","_jsx","jsxs","_jsxs","DetailsCita","_ref","citaForEdit","isModalOpen","setIsModalOpen","getCitasData","id_hospital","pacientesData","_id","id_cita","medico","id_medico","servicio","citaPaid","setCitaPaid","editingCita","setEditingCita","handleOk","handleCancel","checkPayment","concat","then","rs","length","confirm","e","console","log","cancel","confirmPayment","balanceBody","tipo","cita","monto","getAmmount","abono","forma_de_pago","fecha_hora","Date","estado","concepto","success","error","str","match","number","replace","title","open","onOk","onCancel","destroyOnClose","width","footer","description","onConfirm","okText","cancelText","children","danger","onClick","hospital","doctor","name","paciente","toLocaleDateString","toLocaleTimeString","comentarios","style","height","backgroundColor","color"],"sources":["C:/Users/Gil/Documents/ReCreaMed/src/recepcionViews/citas/details-cita.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { Button, Modal, Popconfirm, message } from 'antd'\r\nimport { deleteData, getData, sendDataBody } from '../../resources'\r\nimport { CreateCitaForm } from './create-cita-for-medic'\r\n\r\nexport default function DetailsCita({ citaForEdit, isModalOpen, setIsModalOpen, getCitasData, id_hospital, pacientesData }) {\r\n\r\n    const { _id: id_cita, medico: id_medico, servicio } = citaForEdit;\r\n\r\n    const [citaPaid, setCitaPaid] = useState(false)\r\n\r\n    const [editingCita, setEditingCita] = useState(false)\r\n\r\n    const handleOk = () => { setIsModalOpen(false); setEditingCita(false) }\r\n    const handleCancel = () => { setIsModalOpen(false); setEditingCita(false) }\r\n\r\n    //Check if paid before show confirm button\r\n    useEffect(() => {\r\n        checkPayment(citaForEdit._id)\r\n    }, [citaForEdit])\r\n\r\n    const checkPayment = (id_cita) => {\r\n        getData(`balances/cita/${id_cita}`).then(rs => {\r\n            if (rs.length > 0) {\r\n                setCitaPaid(true)\r\n            } else setCitaPaid(false)\r\n        })\r\n    }\r\n\r\n\r\n    // Delete button\r\n    const confirm = (e) => {\r\n        deleteData(`citas/remove/${citaForEdit._id}`).then((rs) => { console.log(rs); getCitasData(); handleCancel() })\r\n        deleteData(`balances/remove/cita/${citaForEdit._id}`)\r\n    }\r\n    const cancel = (e) => { console.log(e) }\r\n\r\n    //Confirm payment\r\n    const confirmPayment = (e) => {\r\n        const balanceBody = {\r\n            tipo: 'ingreso',\r\n            medico: id_medico,\r\n            cita: id_cita,\r\n            monto: getAmmount(servicio),\r\n            abono: getAmmount(servicio),\r\n            forma_de_pago: 'Efectivo',\r\n            fecha_hora: new Date(),\r\n            estado: 'pendiente',\r\n            concepto: servicio\r\n        }\r\n        console.log('Balance ready to send: ', balanceBody)\r\n        sendDataBody('balances/add', balanceBody).then((rs) => { message.success(rs.message || rs.error); checkPayment(id_cita) })\r\n    }\r\n\r\n\r\n\r\n    const getAmmount = (str) => {\r\n        const match = str.match(/\\$\\d+/);\r\n        if (match) {\r\n            // Eliminamos el signo de dólar para obtener solo el número\r\n            const number = match[0].replace('$', '');\r\n            return number;\r\n        } else {\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    return <Modal title=\"Detalles Cita\" open={isModalOpen} onOk={handleOk} onCancel={handleCancel} destroyOnClose width={900}\r\n        footer={[\r\n            <Popconfirm\r\n                title=\"Eliminar Cita\"\r\n                description=\"Seguro que quiere eliminar la cita?\"\r\n                onConfirm={confirm}\r\n                onCancel={cancel}\r\n                okText=\"Si\"\r\n                cancelText=\"No\"\r\n            >\r\n                <Button danger>Eliminar</Button>\r\n            </Popconfirm>,\r\n\r\n            (!citaPaid && <Popconfirm\r\n                title=\"Confirmar pago\"\r\n                description=\"Recibió el pago correspondiente?\"\r\n                onConfirm={confirmPayment}\r\n                onCancel={cancel}\r\n                okText=\"Si\"\r\n                cancelText=\"No\"\r\n            >\r\n                <Button >Confirmar pago</Button>\r\n            </Popconfirm>),\r\n\r\n            <Button onClick={() => setEditingCita(!editingCita)}>{editingCita ? \"Cancelar\" : \"Modificar\"}</Button>,\r\n            <Button onClick={handleCancel}>Cerrar</Button>\r\n        ]\r\n        }>\r\n\r\n\r\n        {\r\n            editingCita ?\r\n                <CreateCitaForm cita={citaForEdit} setIsModalOpen={setIsModalOpen} getCitasData={getCitasData} setEditingCita={setEditingCita} hospital={id_hospital} pacientesData={pacientesData} />\r\n                : <div>{citaForEdit && <div>\r\n                    <p><strong>Medico </strong>{citaForEdit.doctor ? citaForEdit.doctor.name : 'Sin medico'}</p>\r\n                    <p><strong>Paciente </strong>{citaForEdit.paciente ? citaForEdit.paciente.name : 'Sin paciente'}</p>\r\n                    <p><strong>Fecha </strong>{new Date(citaForEdit.fecha_hora).toLocaleDateString()}</p>\r\n                    <p><strong>Hora </strong>{new Date(citaForEdit.fecha_hora).toLocaleTimeString()}</p>\r\n                    <p><strong>Servicio </strong>{citaForEdit.servicio}</p>\r\n                    <p><strong>Comentarios </strong>{citaForEdit.comentarios}</p>\r\n                    {/* <p><strong>Servicio ID </strong>{citaForEdit.id_servicio}</p> */}\r\n                    <p><strong>Color </strong> <div style={{ width: 18, height: 8, backgroundColor: citaForEdit.color }}></div> </p>\r\n                    {/* <Button type='primary' onClick={confirmService}>Confirmar Servicio</Button>, */}\r\n                </div>\r\n                }\r\n                </div>\r\n        }\r\n    </Modal >\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}